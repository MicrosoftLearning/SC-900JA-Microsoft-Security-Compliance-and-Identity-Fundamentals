---
Demo:
    title: 'Azure ネットワーク セキュリティ グループ (NSG)'
    module: 'モジュール 3 レッスン 1: Microsoft セキュリティ ソリューションの機能を説明する: Azure の基本的なセキュリティ機能について説明する。'
---

# デモ: Azure ネットワーク セキュリティ グループ (NSG)

### デモ シナリオ
このデモでは、Azure ネットワーク セキュリティ グループ (NSG) の機能について説明します。  これを行うには、デモ前のセットアップの一環として、最初に NSG なしで仮想マシン (VM) を作成します。また、インターフェイスやサブネットが関連付けられていない NSG を作成します。  デモの一部として、NSG のデフォルトの受信規則と送信規則について説明します。次に、VM のインターフェイスを NSG に割り当てるプロセスを実行します。  構成した後、既定の NSG 規則や作成した規則を使用して、VM への接続をテストします。
  

#### デモ前のセットアップ パート 1
 講師は、VM の作成に数分かかる可能性があるため、クラス時間の**前**にこれを行うことをお勧めします。このセットアップでは、Windows 10 仮想マシンを作成します。

1. ブラウザーで、「**ホーム – Microsoft Azure**」 タブを開きます。  タブを以前に閉じた場合は、ブラウザー ページを開き、アドレス バーに「portal.azure.com」と入力して、再度サインインします。

1. 検索ボックスのページ上部にある「Microsoft Azure」と表示されている場所の隣の青色バーに、「**仮想マシン**」と入力し、検索結果で、「**仮想マシン**」を選択します。  

1. ページの左上で、「**+ 追加**」を選択してから、 「**+ 仮想マシン**」 を選択します。

1. 「基本」タブで、次の情報を入力します (一覧表示されていない場合は、既定の設定のままにします)。
    1. **サブスクリプション**: Azure Pass - スポンサーシップが既定の設定であることを確認します。
    1. **リソース グループ**: 「**新規作成**」 を選択してから、「名前」フィールドに 「**LabsSC900**」 と入力し、その後、「**OK**」 を選択します。
    1. **仮想マシン名**:  「**SC900-WinVM**」と入力します。
    1. **リージョン**:  既定値のままにします。
    1. **可用性オプション**: 必ず 「**インフラストラクチャの冗長性は不要**」 を選択してください。  注: 可用性オプションを「インフラストラクチャの冗長性は不要」に設定することが非常に重要です。設定しないと、デモが意図したとおりに機能しません。  可用性オプションを使用するには NSG が必要であり、意図的に NSG なしで VM を作成しています。
    1. **イメージ**:  ドロップダウンから、「**Windows 10 Pro、バージョン 20H2 – Gen 1**」 を選択します。
    1. **サイズ**:  ドロップダウンから、「**すべてのサイズを表示**」を選択し、「**B2s**」を選択してから、ページの下部で、 「**選択**」を押します。
    1. **ユーザー名**:  「**AzureUser**」 と入力します。
    1. **パスワード**:  「**SC900AzureLabs**」 と入力します。
    1. **パブリック受信ポート**:  既定の設定のままにすることができます (ネットワーク設定がここで行うことを上書きするため、ここで何を選択してもかまいません)。
    1. **ライセンス**:  「**私はマルチテナント ホスト権限のある適格な Windows 10 ライセンスを持っていることを確認します**」を選択し、ボックスにチェックマークが表示されるようにします。
    1. 「**次へ: ディスク**」を選択します。

1. 現在、VM 構成の「ディスク」タブが表示されています。  すべての設定を既定のままにしてい、「**次へ: ネットワーク >**」を選択します。

1. 現在、VM 構成の「ネットワーク」タブが表示されています。  次の情報を入力します (一覧表示されていない場合は、既定の設定のままにします)。
    1. NIC ネットワーク セキュリティ グループ:  「**なし**」 を選択します。  注: 「なし」を選択すると、NIC に NSG がないことが保証されます。  デモの後続の手順では、NSG を作成し、作成した NSG に VMNIC を割り当てます。
    1. VM の他の設定は既定として保持されるため、先に進んで、「次へ: **Review + Create>**」を選択します。

1. VM の構成を確認します。  いくつかの注意点があります。この VM には、パブリック IP アドレスがありますが、NIC ネットワーク セキュリティ グループはありません。  セキュリティの観点から、これにより、VM は公開された状態になります。  以降のタスクでこれに対処します。**作成** を選択します。  VM のデプロイが完了するまでに数分かかる場合があります。

1. ネットワーク インターフェイスの名前 **sc900-winvmXXX** (XXX は VM のネットワーク インターフェイスに対して固有となります) をメモします。

1. VM のデプロイが完了したら、「**リソースに移動**」 を選択します。  「SC900-WinVM」ページに移動します。  パブリック IP アドレスをメモします。

1. 左ナビゲーション パネルで、「**ネットワーク**」 を選択し、ネットワーク インターフェイス「**sc900-winvmXXX**」をメモします (XXX は VM のネットワークインターフェイスに固有です)。  インターフェイスに関連付けられた受信または送信規則があってはなりません。  

1. VM に接続できることを確認することが重要であるため、ページの上部で、「**接続**」 を選択します。
    1. ページの上部で、「**RDP**」 が選択されている (下線が引かれている) ことを確認します。
    1. IP アドレスがパブリック IP アドレスに設定されていることを確認し、既定のポート番号のままにして、「**DRP ファイルのダウンロード**」 を選択します。
    1. ダウンロードしたファイルを**開**き、表示されるウィンドウで、「**接続**」を選択します。
    1. 資格情報の入力を求めるウィンドウが開きます。既定のウィンドウで PIN が要求された場合は、「**その他の選択肢**」 を選択してから、「**別のアカウントを使用する**」 を選択します。   資格情報の入力を求められます。  「ユーザー名」には、「**AzureUser**」と入力します。  「パスワード」には、「**SC900AzureLabs**」と入力します。
    1. リモート デスクトップ 接続ウィンドウが、「リモート コンポーネントの ID を確認できません。  とにかく世俗しますか?」というメッセージと共に開きます。  「**はい**」を選択します。
    1. 現在、作成したばかりの Windows VM に接続しています。Windows のセットアップを完了します。RDP を介して VM に接続し、通常は RDP ポートを使用していましたが、この VM はすべてのポートが開いており、トラフィックのフィルター処理を行っていません。  IP アドレスが表示されるページの上中央の「**X**」を選択して、リモート デスクトップ接続を閉じます。  ポップアップ ウィンドウに「リモート セッションが閉じられた」ことが表示されます。「**OK**」を選択します。

1. Azure portal の「SC900-WinVM」に戻ります。  次のタスクのために、このブラウザー タブを開いたままにします。

#### デモ前のセットアップ パート 2
ネットワーク セキュリティ グループを作成しますが、VM のネットワーク インターフェイスをその NSG に割り当てないでください。  

1. ブラウザーで、「SC900-WinVM – Microsoft Azure」タブを開きます。

1. 検索ボックスのページ上部にある「Microsoft Azure」と表示されている場所の隣の青色バーに、「**ネットワーク セキュリティ グループ**」と入力し、検索結果で、「**ネットワーク セキュリティ グループ**」を選択します。  ネットワーク セキュリティ グループ クラシックを選択しないでください。

1. 「ネットワーク セキュリティ グループ」ページで、「**+ 作成**」を選択します。

1. 「ネットワーク セキュリティ グループの作成」ページの「基本」タブで、次の設定を指定します。
    1. サブスクリプション:  Azure Pass – スポンサーシップ
    1. リソース グループ:  **LabsSC900-RG**
    1. 名前:  **NSG-SC900**
    1. リージョン:  既定の「**米国東部**」のままにします
    1. 「**Review + create**」を選択してから、「**作成**」を選択します。

1. デプロイが完了したら、「**リソースに移動**」を選択し、すべてが正しいことを確認します。  3 つの既定の受信規則、3 つの既定の送信規則があり、NSG に関連付けられたサブネットとインターフェイスはありません。  Azure portal の「**ホーム**」ページに戻ります。  

#### デモ
NSG の設定について詳しく説明します。  この場合、VM インターフェイスにまだ割り当てられていない既存の NSG (上記のセットアップで作成したもの) について詳しく説明します。次に、インターフェイスを NSG に関連付けるプロセスと、受信規則と送信規則を作成するプロセスについて説明します。

1. ブラウザー タブ 「**ホーム - Microsoft Azure**」 を開きます。  タブを以前に閉じた場合は、ブラウザー ページを開き、アドレス バーに「portal.azure.com」と入力して、再度サインインします。

1. 検索ボックスのページ上部にある「Microsoft Azure」と表示されている場所の隣の青色バーに、 「**ネットワーク セキュリティ グループ**」 と入力し、検索結果で、「**ネットワーク セキュリティ グループ**」を選択します。  ネットワーク セキュリティ グループ クラシックを選択しないでください。

1. NSG ページで、セットアップ「**NSG-SC900**」で作成した NSG を選択します。

1. 左ナビゲーション パネルの「**概要**」タブが強調表示されます。  NSG の既定の受信および送信規則に注意してください。NSG が作成され、トラフィックをフィルター処理するための既定の規則がありますが、NSG に関連付けられているインターフェイスはありません。これは、ページの右上にある "関連付けられている: 0 サブネット、0 ネットワーク インターフェース" で確認できます。  NSG がそのことを行うには、何かに割り当てる必要があります。  この場合、以前に作成された VM のネットワーク インターフェイスに割り当てます。

1. 「NSG-SC900」ページの「左ナビゲーション」ペインの「設定」の下で、「**ネットワーク インターフェイス**」を選択します。

1. 検索ボックスの上にある「**+ 関連付け**」を選択し、ドロップダウンで、「**sc900-winvmXXX**」 (XXX は VM のネットワーク インターフェイスに固有) を選択して、「**OK**」を選択します。インターフェイスが関連付けられると、画面の右上隅に通知ボックスが表示されます。インターフェイスが NSG に関連付けられると、一覧に表示されます。

1. 「**概要**」 タブに戻ります。  ページの右上に「関連付けられている: 0 サブネット、1 ネットワーク インターフェイス」と表示されていることに注意してください。これで、インターフェースが NSG に割り当てられました。また、学習者に既定の規則を強調します。受信の場合、他の Azure 仮想ネットワークと Azure Load Balancer からのトラフィックのみが許可されます。VM への他のすべての受信トラフィックは拒否されます。また、既定の送信規則を呼び出します。  他の vne tへの送信ラフィックと送信インターネット トラフィックのみが許可されます。  デモの一環として、受信トラフィックが拒否されたことを示すために 1 分かかることをお勧めします。
    1. ページの上部にある検索バーに「**仮想マシン**」と入力して、選択します。
    1. 「仮想マシン」ページで、「**SC900-WinVM**」を選択します。
    1. 「SC900-WinVM」ページの上部で、「**接続**」を選択してから、「**RDP**」を選択します。
    1. IP アドレスがパブリック IP アドレスに設定されていることを確認し、既定のポート番号のままにして、「**DRP ファイルのダウンロード**」を選択します。
    1. ダウンロードしたファイルを**開き**、「**接続**」を選択します。
    1. 接続を試みてから数秒後、「リモート デスクがリモート コンピューターに接続できない」ことを示す失敗メッセージが表示されます。「**OK**」を選択します。

1. NSG の既定の受信規則の影響について説明したので、受信 RDP トラフィックを許可する新しい規則を作成する必要があります。  既存の既定の規則を削除することはできません。作成できるのは、優先度の高い新しい規則のみです。
    1. 左ナビゲーション パネルで、「設定」の下の「**ネットワーク**」を選択します。  VMのネットワーク ページが表示されています。ここから受信規則と送信規則を作成できますが、すべてのデモが NSG に関するものであるため、「NSG」ページに戻ります。 **「NSG-SC900」を選択します。** これは、ウィンドウの中央にあるリンクです。

1. これで、「NSG の概要」ページが表示されます。  NSG に関する情報に注意してください。「NSG」ページの左ナビゲーション パネルの「設定」で、「**受信セキュリティ規則**」を選択し、ページの上部で、「**+ 追加**」を選択します。「受信セキュリティ規則の追加」ページで、さまざまな設定について説明します。次の設定で、受信 RDP トラフィックを許可する規則を実際に作成することをお勧めします。
    1. ソース: **指定なし**
    1. 送信元ポートの範囲: **\***
    1. 宛先: **指定なし**
    1. サービス: **RDP**
    1. アクション: **許可**
    1. 優先度: **300**。注: 小さい数字の規則は高い優先順位を持ち、最初に処理されます。したがって、この新しい規則の優先度は、すべての受信トラフィックを拒否する既存の規則の優先度よりも高くする必要があります。
    1. 名前: **AllowRDP**
    1. 「**追加**」を選択します
    1. 規則がプロビジョニングされると、受信規則の一覧に表示されます。

1. 次に、**送信セキュリティ規則**を確認します。  ページの上部で、「**+ 追加**」を選択し、さまざまな設定について説明します。  ルールを作成することをお勧めします – 以下の設定は、送信インターネット トラフィックを拒否する規則を作成します。
    1. ソース: **指定なし**
    1. 送信元ポートの範囲: **\***
    1. 宛先: **サービス タグ**
    1. 宛先サービス タグ: **インターネット**
    1. サービス: **カスタム** (既定のままにします)
    1. 宛先ポート範囲: **\*** (宛先ポート範囲フィールドに必ずアスタリスクを入力してください)
    1. プロトコル: **指定なし**
    1. アクション: **Deny**
    1. 優先度: **4000** (注意すべき点は、インターネット送信トラフィックを許可する既存の規則の優先度よりも優先度を高くする必要があるということです。)
    1. 名前: **DenyInternet**
    1. 「**追加**」を選択します
    1. 規則がプロビジョニングされると、送信規則の一覧に表示されます。

1. 次に、VM に戻り、規則をテストします。  ページの上部で、送信セキュリティ規則が表示されている 「**SC900-VM**」 を選択します。

1. RDP を使用して、VM に接続できることを確認して、受信規則をテストします。
    1. 左ナビゲーション パネルで、「**接続**」を選択します。
    1. IP アドレスがパブリック IP アドレスに設定されていることを確認し、既定のポート番号のままにして、 「**DRP ファイルのダウンロード**」 を選択します。
    1. ダウンロードしたファイルを**開き**、「**接続**」を選択します。
    1. 資格情報の入力を求められます。「ユーザー名」には、「**AzureUser**」と入力します。「パスワード」には、 「**SC900AzureLabs**」 と入力します。  資格情報の入力を求めるウィンドウで PIN が要求された場合は、「**その他の選択肢**」を選択してから、「**別のアカウントを使用する**」を選択します。
    1. リモート デスクトップ 接続ウィンドウが、「リモート コンポーネントの ID を確認できません。とにかく世俗しますか?」というメッセージと共に開きます。「**はい**」を選択します。
    1. これで VM に接続されました。作成した受信トラフィック規則が RDP を介した VM への受信トラフィックを許可しているため、この場合、VM に接続できたことを学習者に強調します。

1. 次に、送信 NSG 規則をテストします
    1. VM で Microsoft Edge ブラウザーを開きます。
    1. **https://www.bing.com** と入力します。ページは表示されません。注: インターネットに接続でき、送信規則のすべてのパラメーターが適切に設定されていたことを確認した場合、これは規則が有効になるまで数分かかることによる可能性があります。しばらく待ってから再試行してください。

1. IP アドレスが表示されるページの上中央の「**X**」を選択して、リモート デスクトップ接続を閉じます。ポップアップ ウィンドウに「リモート セッションが閉じられた」ことが表示されます。「**OK**」を選択します。

1. ページ上部の青色バーで、 「**Microsoft Azure**」 を選択して、Azure portal の「ホーム」ページに戻ります。

#### 破棄
**重要**: このタスクでは、リソース グループとそれに含まれるすべてのリソースが削除されます。   これは、追加料金を避けるために重要です。

1. ブラウザーで、「SC900-WinVM – Microsoft Azure」タブを開きます。

1. ページの左下隅で、 「**すべてのサービス**」 を選択します。

1. 「すべてのサービス」の隣の「フィルター サービス」ボックスで、「**リソース グループ**」と入力し、結果から、「**リソース セキュリティ グループ**」を選択します。

1. 「**LabsSC900-RG**」を選択します。

1. 「LabsSC900-RG」ページの中央上で、 「**リソース グループの削除**」 を選択します。

1. 開くウィンドウで、リソース グループ名「**LabsSC900-RG**」を入力して、リソース グループとそのすべてのリソースの削除を確認してから、ページの下部で、「**削除**」を選択します。

1. すべてのリソースとリソース グループが削除されるまで数分かかる場合があります。

#### レビュー

このデモでは、インターフェイスを NSG に関連付けるプロセスなど、NSG に関連付けられた情報と設定について説明し、既定の受信規則と送信規則について説明し、最後に新しい規則を作成する手順について説明しました。

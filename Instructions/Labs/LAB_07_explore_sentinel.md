---
lab:
    title: 'Azure Sentinel の詳細を確認する'
    module: 'モジュール 3 レッスン 3: Microsoft セキュリティ ソリューションの機能を説明する: Azure Sentinel のセキュリティ機能について説明する'
---


# ラボ: Azure Sentinel の詳細を確認する 

## ラボ シナリオ
このラボでは、Azure Sentinel インスタンスの作成プロセスを詳しく説明します。  また、Azure Sentinel をサポートするためにデプロイするリソースへのアクセスを保証するためのアクセス許可を設定します。  この基本設定が完了した後、Sentinel をデータ ソースに接続し、組み込み分析を使用して疑わしいことを通知する手順を詳しく説明します。そして、最後に自動機能の詳細を確認します。  

  

**予想時間**: 30 ～ 45 分

#### タスク 1:  Azure Sentinel インスタンスを作成します。

1. Microsoft Edge を開きます。アドレス バーに、「**portal.azure.com**」 と入力します。

2. 管理者の資格情報でサインインします。
    1. 「サインイン」ウィンドウで、「**admin@WWLxZZZZZZ.onmicrosoft.com**」 (ZZZZZZ はラボ ホスティング プロバイダーにより提供される一意のテナント ID です) を入力してから、「**次へ**」を選択します。
    
    1. ラボ ホスティング プロバイダーから提供される管理者のパスワードを入力します。「**サインイン**」を選択します。
    1. サインインしたままにするかどうかを尋ねられたら、「**はい**」を選択します。

3. Microsoft Azure の隣の画面の左上隅で、「ポータル メニューの表示」アイコン (3 本の水平方向のラインのあるアイコンで、「ハンバーガー」アイコンとも呼ばれます) を選択してから、「**すべてのサービス**」を選択します。  

4. 「フィルター サービス」ボックスに、「**Sentinel**」 と入力してから、一覧で 「**Azure Sentinel**」 を選択します。

5. 「Azure Sentinel」ページで、「**Azure Sentinel の作成**」 を選択します。

6. 「ワークスペースへの Azure Sentinel の追加」ページで、「**新しいワークスペースの作成**」 を選択します。

7. 「Log Analytics ワークスペースの作成」の「基本」タブに、次の情報を入力します。
    1. サブスクリプション:  **Azure Pass – スポンサーシップ**
   
    1. リソース グループ: 「**新規作成**」を選択してから、名前 「**SC900-ResourceGroup**」 を入力し、その後 「**OK**」 を選択します。
    1. 名前: **SC900-LogAnalytics-workspace**.
    1. リージョン: **米国東部** (既定のままにします)
    1. 「**次へ: 価格レベル >」** を選択します**

8. 「価格レベル」については、既定の設定: **Pay-as-you-go (per GB 2018)** のままにして、 「**次へ: タグ >**」 を選択します。

9. 「タグ」については、空白のままにして、「**Review + Create**」を選択します。
 
10. 入力した情報を確認してから、「**作成**」を選択します。

11. 新しいワークスペースが一覧表示されない場合は、「**更新**」 を選択してから、 「**追加**」 を選択します。

12. 新しいワークスペースが選択されると、「Azure Sentinel | のニュースとガイドライン」ページが表示されます。  「作業開始」ページに 3 つの手順を一覧表示されることに注意してください。

13. 次のタスクで使用するため、このページを開いたままにしておきます。

#### タスク 2:  Azure Sentinel インスタンスが作成されると、Azure Sentinel をサポートするためにデプロイするリソースに対して、必要なアクセス権があることを確認する必要があります。  このタスクでは、Azure Sentinel を使用して作成したリソース グループのアクセス制御 (IAM) ページに移動して、利用可能なロールを表示し、自分自身 (MOD 管理者) に必要なロールを割り当てます。リソース グループ レベルにロールを割り当てることで、Azure Sentinel をサポートするためにデプロイされるすべてのリソースにロールが適用されることが保証されます。

1. 「Azure Sentinel」ページで、Azure Sentinel を上部に表示するページの左上隅で、「**すべてのサービス**」を選択します。

2. 「フィルター サービス」ボックスに、「リソース グループ」を入力し、表示される一覧で、「**リソース グループ**」を選択します。

3. 「リソース グループ」ページで、Azure Sentinel を使用して作成したリソース グループ「**SC900-ResourceGroup**」を選択します。

4. 「SC900-ResourceGroup」ページの左ナビゲーション パネルで、「**アクセス制御 (IAM)**」を選択します。

5. 「アクセス制御」ページで、「**自分のアクセスの表示**」を選択します。  現在のロールがセキュリティ管理者であることに注意してください。  ウィンドウの右上隅の 「**X**」 を選択して、「MOD 管理者割り当て」ウィンドウを閉じます。

6. 「アクセス制御」ページで、「**+ 追加**」を選択してから、「**ロール割り当ての追加**」 を選択します。

7. 「ロール割り当ての追加」ウィンドウが開きます。  「ロール フィールドの選択」で、ドロップダウン矢印を選択して、利用可能なロールを表示します。  このラボでは、「**所有者**」 を選択します。  注:  ベスト プラクティスとして、ロールに必要な最小特権を割り当てる必要があります。  参照として、Azure Sentinel のアクセス許可を確認します。  https://docs.microsoft.com/ja-jp/azure/sentinel/roles

8. 表示されるユーザーの一覧で、「**MOD 管理者**」 を選択します。

9. ページの下部にある 「**保存**」 を選択します。

10. 「アクセス制御」ページで、「**自分のアクセスの表示**」 を選択し、ロールが追加されたことを確認してから、ウィンドウの右上隅で、「**X**」 を選択してウィンドウを閉じます。

11. 上部にリソース グループを表示するページの左上隅で、「**すべてのサービス**」 を選択して、Azure の「すべてのサービス」ページに戻ります。

#### タスク 3:  このタスクでは、データの収集を開始するために、Azure Sentinel をデータ ソースに接続するプロセスを詳しく説明します。注: コネクタの接続状態を表示するのに少し時間がかかる場合があります (テナントに応じて、約 30 分)。

1. 「すべてのサービス」ページの「フィルター サービス」ボックスに、「**Azure Sentinel**」 と入力し、結果一覧で、「**Azure Sentinel**」 を選択します。 

2. 「Azure Sentinel」ページで、Azure Sentinelのインスタンスを使用して作成したワークスペース 「**SC900-LogAnalytics-workspace**」 を選択します。

3. Azure Sentinelを使用する最初の手順は、データを収集できるようにすることです。左ナビゲーション パネルで、構成の下に一覧表示される「**データ コネクタ**」を選択します。

4. 「データ コネクタ」ページで、「メイン」ウィンドウで下にスクロールして、利用可能なコネクタの広範な一覧を表示します。「データ コネクタ」ページの「検索」ボックスに、「**Azure**」と入力して、一覧から「**Azure Active Directory**」を選択します。

5. 「Azure Active Directory コネクタ」ウィンドウが開きます。  「**コネクタ ページを開く**」 を選択します。

6. 「Azure Active Directory コネクタ」ページで、説明を確認し、ワークブック、クエリ、分析規則テンプレートを含む関連コンテンツをメモします。  

7. 「メイン」ウィンドウの「手順」タブには、Azure Sentinel を Azure Active Directory に統合するための前提条件が表示されます。   構成の下で、「**サインイン ログ**」を選択してから、「変更の適用」を選択します (複数のコネクタを選択できます)。

8. 「次のステップ」タブで、推奨されるワークブックの一覧に注意してください。   「推奨されるワークブック」の下で、「**Azure サインイン ログ**」を選択します (追加ワークブックを選択できます)。

9. 「テンプレート」タブが選択された状態 (下線) の「ワークブック」ページで、「**Azure サインイン ログ**」を選択します。 

10. 開く「Azure AD サインイン ログ」ウィンドウで、説明を確認し、「**テンプレートの表示**」 を選択します。  画面に右上隅の 「**X**」 を選択して、テンプレートを終了します。  ページの下部で、「**保存**」を選択してから、「**OK**」を選択して、ワークブックを既定の場所に保存します。

11. ワークブックを上部に表示する「ワークブック」ページの左上隅で、 「**Azure Sentinel**」 を選択します。これにより、「Azure Sentinel データ コネクタ」ページに戻ります。

12. 「データ コネクタ」ページの上部に「1 接続中」と表示されるはずです。これは、現在、あなたが Azure Active Directory に接続していることを反映しています。

13. 左ナビゲーション パネルで、「**ワークブック**」を選択します。

14. 「ワークブック」ページで、「検索」ボックスの上に表示される「**自分のワークブック**」タブを選択します。  保存したばかりのワークブックが一覧表示され、データを確認および監視するために利用できます。

15. 次のタスクで使用するため、このページを開いたままにしておきます。

#### タスク 4:  このタスクでは、疑わしいことが発生したときに通知するための規則を作成する組み込み規則テンプレートを使用するプロセスを詳しく説明します。

1. 左ナビゲーション パネルで、「**分析**」 を選択します。

2. 「分析」ページには、アクティブな規則 (既定で高度なマルチステージ攻撃の検出が有効になっています) が表示され、規則テンプレートにアクセスすることもできます。  「**規則テンプレート**」タブを選択します。  利用可能なテンプレートの一覧と一覧をフィルター処理するためのさまざまな方法に注意してください。  Azure Sentinel ワークスペース内で組み込み分析アラートを使用すると、疑わしい現象が発生したときに通知を受け取ることができます。

3. 「検索」バーに、「**Azure portal**」と入力します。  「**Azure portal へのログインに失敗しました**」 を選択します。  

4. 開くウィンドウで、説明を読み、テンプレートに関連する情報を確認します。  ページの下部にある 「**規則の作成**」 を選択します。

5. 「分析規則」ウィザードで、情報を確認してから、 「**次へ: ルール ロジックの設定 >**」 を選択します。

6. 「ルール ロジックの設定」ページでは、新しい分析規則のロジックを定義します。テンプレートには、いくつかロジックと事前に定義された設定がすでに提供されています。  ページをスクロールして、利用可能な設定を確認します。  既定値のままにします。「**次へ: インシデントの設定 (プレビュー)>**」を選択します。

7. 「インシデントの設定」で、Azure Sentinel アラートを一緒に考慮する必要のあるインシデントにグループ化できます。この分析規則によりトリガーされるアラートがインシデントを生成するかどうかを設定できます。  既定の設定のままにして、「**次へ: 自動応答 >**」を選択します。

8. 「自動応答」タブでは、応答を自動化するためにプレイブックを追加する方法に注意してください。  同様に、インシデントの自動化規則を作成できます。  「インシデントの自動化」の下で、「**+ 追加**」を選択します。  新しい自動化規則を作成するためのウィンドウが開きます。  このページで作成される自動化規則は、分析規則によりトリガーされます。規則に条件を追加したり、アクションを設定したりできることに注意してください。   「**キャンセル**」を選択して、ウィンドウを終了します

9. 「**次へ: レビュー >**」 を選択して、選択したテンプレートに基づいて、規則に関連するすべての詳細を確認します。この時点では、「**作成**」を選択して規則を作成するか、ページの右上隅で、「**X**」を選択して、規則を選択せずに終了することを選択できます。

10. 次のタスクで使用するため、このページを開いたままにしておきます。

#### タスク 5:  前のタスクでは、疑わしいアクティビティを警告するための分析規則を作成しました。  そのウィザードに埋め込まれたオプションは、特定の規則に基づいて、インシデントに対する応答を自動化します。  しかし、自動化構成オプションに直接移動して、自動化規則を作成することもできます。

1. 左ナビゲーション パネルで、 「**自動化**」 を選択します。  

2. 「**+ 作成**」 を選択します。ドロップダウンで、新しいプレイブックの追加、または新しい規則の追加を選択する方法に注意してください。  「**新しいルールの追加**」を選択します。  

3. 新しい自動化規則を作成するためのウィンドウが開きます。  ルールに条件を追加したり、アクションを設定したりできることに注意してください。  唯一の違いは、最初の条件がこの自動化規則を適用する分析規則に関連することです。  これは、前のタスクでは、特定の規則に対して、自動化を構成していため、グレイアウトされていました。  「**キャンセル**」を選択して、「新しい自動化規則の作成」ウィンドウを終了します。

4. 次のタスクで使用するため、このページを開いたままにしておきます。


#### タスク 6:  Azure Sentinel リソース グループを削除します。  Azure Sentinel の課金は、分析のために Azure Sentinel に取り込まれたデータの量に基づいて行われます。このラボの結果として取り込まれるデータの量は最小限ですが、Azure Sentinel の機能の調査が完了したとき、Azure Sentinel リソース グループを削除することを推奨します。

1. 「Azure Sentinel」ページで、Azure Sentinel を上部に表示するページの左上隅で、「**すべてのサービス**」 を選択します。

2. 「フィルター サービス」ボックスに、「リソース グループ」を入力し、表示される一覧で、 「**リソース グループ**」 を選択します。

3. 「リソース グループ」ページで、Azure Sentinel を使用して作成したリソース グループ「**SC900-ResourceGroup**」を選択します。

4. ページの中央上で、「**リソース グループの削除**」を選択します。  警告を確認します。  リソース グループ名「**SC900-ResourceGroup**」を入力してから、ページの下部の「**削除**」を選択します。  リソース グループを削除するのに数分かかります。

5. リソース グループが削除されたことを確認し、「ブラウザー」ページを閉じます。 


#### レビュー

このラボでは、Azure Sentinel インスタンスの作成プロセスを詳しく説明しました。  また、Azure Sentinel をサポートするためにデプロイするリソースへのアクセスを保証するためのアクセス許可を設定しました。  Azure Sentinel インスタンスを作成した後、Sentinel をデータ ソースに接続し、組み込み分析を使用して疑わしいことを通知する手順を詳しく説明しました。そして、最後に自動機能の詳細を確認しました。作成した Azure Sentinel のインスタンスに関連するリソース グループを削除して、ラボを終了しました。
